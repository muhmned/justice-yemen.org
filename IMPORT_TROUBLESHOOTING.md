# 🔧 استكشاف أخطاء استيراد النسخ الاحتياطية

## 🚨 المشكلة: "حدث خطأ بالاتصال بالخادم" عند الاستيراد

### 🔍 التشخيص السريع:

#### 1. فحص حالة الخادم:
```bash
curl http://localhost:5000/api/health
curl http://localhost:5000/api/health/db
```

#### 2. فحص ملفات النسخ الاحتياطية:
```bash
ls backend/backups/
```

#### 3. فحص مجلد uploads:
```bash
ls backend/uploads/
```

---

## 🛠️ الحلول المقترحة:

### ✅ الحل الأول: إعادة تشغيل الخوادم
```bash
# إيقاف الخوادم (Ctrl+C)
# ثم إعادة التشغيل
cd backend && npm run dev
cd frontend && npm start
```

### ✅ الحل الثاني: فحص نوع الملف
- تأكد من أن الملف المرفوع هو `.json`
- تأكد من أن الملف صالح وغير تالف

### ✅ الحل الثالث: فحص الصلاحيات
```bash
# التأكد من وجود صلاحيات الكتابة
chmod 755 backend/uploads/
chmod 755 backend/backups/
```

### ✅ الحل الرابع: فحص حجم الملف
- تأكد من أن حجم الملف أقل من 50MB
- إذا كان كبير جداً، جرب إنشاء نسخة احتياطية أصغر

---

## 🔍 التشخيص التفصيلي:

### 1. فحص سجلات الخادم:
```bash
# في terminal الخادم، ابحث عن:
[REQUEST] POST /api/import
Import error:
```

### 2. فحص Console المتصفح:
```javascript
// افتح Developer Tools (F12)
// اذهب إلى Console
// ابحث عن:
Importing file:
Import response status:
Import response data:
```

### 3. فحص ملف النسخة الاحتياطية:
```bash
# فحص محتوى الملف
head -20 backend/backups/backup-*.json
```

---

## 🎯 الأخطاء الشائعة وحلولها:

### ❌ خطأ: "لم يتم رفع أي ملف"
**السبب**: لم يتم اختيار ملف
**الحل**: اختر ملف JSON صالح

### ❌ خطأ: "يسمح فقط بملفات JSON"
**السبب**: نوع ملف غير صحيح
**الحل**: اختر ملف بامتداد `.json`

### ❌ خطأ: "ملف JSON غير صالح"
**السبب**: الملف تالف أو غير صحيح
**الحل**: أنشئ نسخة احتياطية جديدة

### ❌ خطأ: "خطأ في الصلاحيات"
**السبب**: عدم وجود صلاحيات الكتابة
**الحل**: تحقق من صلاحيات المجلدات

### ❌ خطأ: "الملف غير موجود"
**السبب**: مشكلة في مسار الملف
**الحل**: أعد تشغيل الخادم

---

## 🧪 اختبار سريع:

### 1. إنشاء نسخة احتياطية جديدة:
- اذهب إلى صفحة النسخ الاحتياطية
- أنشئ نسخة احتياطية جديدة
- تأكد من نجاح العملية

### 2. اختبار الاستيراد:
- اختر النسخة الاحتياطية الجديدة
- اضغط "استيراد النسخة الاحتياطية"
- راقب الرسائل في Console

### 3. فحص النتيجة:
- تحقق من رسالة النجاح
- تحقق من تحديث البيانات

---

## 📞 إذا استمرت المشكلة:

### 1. جمع المعلومات:
- لقطة شاشة للخطأ
- محتوى Console المتصفح
- سجلات الخادم

### 2. فحص النظام:
```bash
# فحص مساحة القرص
df -h

# فحص الذاكرة
free -h

# فحص العمليات
ps aux | grep node
```

### 3. إعادة تثبيت:
```bash
# حذف node_modules وإعادة التثبيت
rm -rf node_modules
npm install
```

---

## 🎯 النتيجة المتوقعة:

بعد تطبيق الحلول، يجب أن تعمل عملية الاستيراد بشكل صحيح:

✅ **رسالة نجاح**: "تم استيراد قاعدة البيانات بنجاح"  
✅ **تحديث البيانات**: ظهور البيانات المستوردة  
✅ **تسجيل العملية**: في سجل النشاطات  

---

**💡 نصيحة**: إذا استمرت المشكلة، جرب إنشاء نسخة احتياطية جديدة واستيرادها بدلاً من النسخة القديمة. 