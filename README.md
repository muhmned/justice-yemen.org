# نظام إدارة المحتوى - النسخ الاحتياطية

## نظرة عامة

هذا النظام يتيح إدارة المحتوى مع نظام نسخ احتياطية متكامل لقاعدة البيانات. يتضمن:

- إدارة المقالات والأخبار والتقارير
- نظام مستخدمين مع صلاحيات متقدمة
- نظام نسخ احتياطية شامل
- واجهة إدارة حديثة وسهلة الاستخدام

## المميزات الجديدة - النسخ الاحتياطية

### أنواع النسخ الاحتياطية

1. **نسخة كاملة (Full Backup)**
   - جميع البيانات في قاعدة البيانات
   - المستخدمين، الأقسام، المقالات، الأخبار، التقارير، الإعدادات
   - سجل النشاطات والمعلومات الأساسية

2. **الجداول الرئيسية (Tables)**
   - المستخدمين، الأقسام، المقالات، الأخبار، التقارير
   - لا يشمل الإعدادات وسجل النشاطات

3. **الأقسام والمقالات (Sections)**
   - الأقسام والفئات والمقالات فقط
   - مفيد للنسخ الاحتياطية السريعة للمحتوى

### الوظائف المتاحة

- ✅ إنشاء نسخ احتياطية
- ✅ استيراد نسخ احتياطية
- ✅ عرض قائمة النسخ الاحتياطية
- ✅ حذف النسخ الاحتياطية
- ✅ تسجيل جميع العمليات في سجل النشاطات

## متطلبات النظام

- Node.js (الإصدار 16 أو أحدث)
- PostgreSQL
- npm أو yarn

## التثبيت والتشغيل

### 1. تثبيت التبعيات

```bash
# تثبيت تبعيات الباك إند
cd backend
npm install

# تثبيت تبعيات الفرونت إند
cd ../frontend
npm install
```

### 2. إعداد قاعدة البيانات

```bash
# في مجلد backend
npx prisma generate
npx prisma db push
```

### 3. إعداد ملف البيئة

أنشئ ملف `.env` في مجلد `backend`:

```env
DATABASE_URL="postgresql://username:password@localhost:5432/database_name"
JWT_SECRET="your-secret-key-here"
PORT=5000
```

### 4. تشغيل النظام

```bash
# تشغيل الباك إند (في مجلد backend)
npm run dev

# تشغيل الفرونت إند (في مجلد frontend)
npm start
```

## الوصول للنظام

- **الواجهة الأمامية**: http://localhost:3000
- **لوحة الإدارة**: http://localhost:3000/admin
- **API الخادم**: http://localhost:5000

## استخدام النسخ الاحتياطية

### الوصول لصفحة النسخ الاحتياطية

1. سجل دخولك للوحة الإدارة
2. اذهب إلى **الإعدادات** → **النسخ الاحتياطية**

### إنشاء نسخة احتياطية

1. اختر نوع النسخة الاحتياطية المطلوبة
2. اضغط على **"إنشاء نسخة احتياطية"**
3. انتظر حتى اكتمال العملية
4. ستظهر النسخة الاحتياطية في القائمة

### استيراد نسخة احتياطية

⚠️ **تحذير**: سيتم استبدال البيانات الموجودة

1. اختر ملف النسخة الاحتياطية (.json)
2. اضغط على **"استيراد النسخة الاحتياطية"**
3. أكد العملية
4. انتظر حتى اكتمال الاستيراد

### إدارة النسخ الاحتياطية

- **عرض القائمة**: جميع النسخ الاحتياطية مع التفاصيل
- **حذف نسخة**: اضغط على زر الحذف بجانب النسخة المطلوبة
- **تفاصيل النسخة**: الحجم، التاريخ، النوع، الإصدار

## هيكل المشروع

```
project/
├── backend/
│   ├── src/
│   │   ├── controllers/
│   │   │   └── backupController.js    # منطق النسخ الاحتياطية
│   │   ├── routes/
│   │   │   └── backupRoutes.js        # مسارات النسخ الاحتياطية
│   │   └── server.js                  # الخادم الرئيسي
│   ├── backups/                       # مجلد النسخ الاحتياطية
│   └── prisma/
│       └── schema.prisma              # مخطط قاعدة البيانات
├── frontend/
│   ├── src/
│   │   ├── pages/admin/
│   │   │   ├── BackupPage.js          # صفحة النسخ الاحتياطية
│   │   │   └── BackupPage.css         # تنسيق الصفحة
│   │   └── components/admin/
│   │       └── AdminSidebar.js        # شريط التنقل
└── README.md
```

## API Endpoints

### النسخ الاحتياطية

- `POST /api/backup` - إنشاء نسخة احتياطية
- `POST /api/import` - استيراد نسخة احتياطية
- `GET /api/backups` - الحصول على قائمة النسخ الاحتياطية
- `DELETE /api/backups/:filename` - حذف نسخة احتياطية

### مثال على إنشاء نسخة احتياطية

```javascript
const response = await fetch('/api/backup', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}`
  },
  body: JSON.stringify({ type: 'full' })
});
```

## الأمان

- جميع عمليات النسخ الاحتياطية تتطلب مصادقة
- تسجيل جميع العمليات في سجل النشاطات
- التحقق من صحة ملفات النسخ الاحتياطية
- حماية من استبدال البيانات غير المقصود

## استكشاف الأخطاء

### مشاكل شائعة

1. **خطأ في الاتصال بقاعدة البيانات**
   - تأكد من تشغيل PostgreSQL
   - تحقق من إعدادات DATABASE_URL

2. **خطأ في إنشاء النسخ الاحتياطية**
   - تأكد من وجود صلاحيات الكتابة في مجلد backups
   - تحقق من مساحة القرص المتاحة

3. **خطأ في الاستيراد**
   - تأكد من صحة ملف النسخة الاحتياطية
   - تحقق من إصدار الملف

### سجلات الأخطاء

- سجلات الباك إند: `backend/error.log`
- سجلات النشاطات: في قاعدة البيانات (ActivityLog)

## الدعم

للمساعدة أو الإبلاغ عن مشاكل، يرجى التواصل مع فريق التطوير.

---

**تم تطوير هذا النظام بواسطة فريق التطوير** 