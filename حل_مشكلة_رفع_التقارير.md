# حل مشكلة رفع التقارير - الصور والملفات PDF

## 🔍 المشكلة
كانت الصور والملفات PDF لا يتم حفظها في قاعدة البيانات عند إضافة تقرير جديد.

## 🛠️ الحل المطبق

### 1. تعديل reportController.js
تم تعديل دالة `createReport` و `updateReport` لتقبل URLs للملفات بدلاً من ملفات فعلية:

```javascript
// قبل التعديل
const { title, summary, content, publishDate, status } = req.body;

// بعد التعديل  
const { title, summary, content, publishDate, status, pdfUrl, thumbnail } = req.body;
```

### 2. تعديل مسارات رفع الملفات في الواجهة الأمامية
تم تغيير مسارات رفع الملفات من نسبية إلى مطلقة:

```javascript
// قبل التعديل
action: '/api/upload'

// بعد التعديل
action: 'http://localhost:5000/api/upload'
```

### 3. الملفات المعدلة
- `backend/src/controllers/reportController.js`
- `frontend/src/pages/admin/AddReport.js`
- `frontend/src/pages/admin/EditReport.js`

## 🔧 كيفية عمل النظام الآن

### 1. رفع الملفات
- يتم رفع الصور والملفات PDF عبر `/api/upload`
- يتم إرجاع URL للملف المرفوع
- يتم حفظ URL في حالة المكون

### 2. حفظ التقرير
- يتم إرسال البيانات كـ JSON مع URLs الملفات
- الخادم يحفظ URLs في قاعدة البيانات
- يتم ربط الملفات بالتقرير

### 3. عرض الملفات
- يتم عرض الصور مباشرة من URL المحفوظ
- يتم ربط ملفات PDF للتحميل

## 🧪 اختبار النظام

### تشغيل الاختبار
```bash
node test_report_upload_fixed.js
```

### خطوات الاختبار
1. تسجيل الدخول
2. رفع صورة
3. رفع ملف PDF
4. إنشاء تقرير
5. التحقق من حفظ البيانات

## 📋 التحقق من الإصلاح

### في قاعدة البيانات
```sql
SELECT id, title, thumbnail, pdfUrl FROM "Report" ORDER BY "publishDate" DESC LIMIT 5;
```

### في الواجهة الأمامية
1. اذهب إلى صفحة إضافة تقرير
2. ارفع صورة وملف PDF
3. املأ البيانات المطلوبة
4. احفظ التقرير
5. تحقق من ظهور الصورة والملف

## 🚨 ملاحظات مهمة

### 1. مجلد uploads
تأكد من وجود مجلد `backend/uploads` وأنه قابل للكتابة.

### 2. صلاحيات الملفات
تأكد من أن الخادم لديه صلاحيات قراءة وكتابة في مجلد uploads.

### 3. حجم الملفات
الحد الأقصى لحجم الملفات هو 10 ميجابايت.

### 4. أنواع الملفات المدعومة
- الصور: JPG, PNG, GIF, WEBP
- المستندات: PDF فقط

## 🔄 في حالة استمرار المشكلة

### 1. فحص السجلات
```bash
tail -f backend/error.log
```

### 2. فحص قاعدة البيانات
```bash
# في psql
SELECT * FROM "Report" WHERE "thumbnail" IS NOT NULL OR "pdfUrl" IS NOT NULL;
```

### 3. فحص مجلد uploads
```bash
ls -la backend/uploads/
```

## ✅ النتيجة المتوقعة
بعد تطبيق هذه الإصلاحات، يجب أن تعمل صفحة التقارير بشكل صحيح:
- رفع الصور والملفات PDF
- حفظ URLs في قاعدة البيانات
- عرض الملفات في الواجهة الأمامية
- إمكانية تحميل ملفات PDF 